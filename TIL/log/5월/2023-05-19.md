# 2023-05-19

# Log

## 우잉클

어떤 회사에 가고싶은지 이야기하는 시간을 가졌다.

나는 즐겁게 일할 수 있는 회사를 원하지만 요즘 새로운 무언가 시도하고자 할 때 경제적으로 부족함이 없을 정도로 돈을 비축해두고 싶다는 생각도 든다.

요즘 이렇게 빠른 경제적 독립을 원하는 성향을 가지는 사람을 파이어족이라고 일컫는다고 한다.

주로 밀레니얼 세대에서 부각된다는데 왜 그럴까...?

아무튼 잘은 모르겠지만 나는 파이어족인가보다~ 싶다

## 💬 데일리

그레이가 인물 맞추기 게임을 준비해왔다!

우리팀이 졌다 ㅋㅋㅋ

나 인물맞추기 진짜 못한다 ㅋㅋㅋ큐ㅠㅠ

## 미션

경로탐색에 대한 테스트를 작성하는데 서울 지하철 노선도를 보면서 테스트를 작성하다보니 시간이 좀 오래걸렸다... 오늘중으로 리뷰요청을 보내고싶었지만 조금 더 보완해서 보내고싶은 마음에 조금 미뤄졌다.

소니 죄송합니다 🙏

## 방탈출

방탈출 케로, 루카, 후추랑 같이 건대로 방탈출을 하러갔다.

스토리가 중요한 테마였는데 감성왕 루카는 스토리에 완전 몰입하고 나머지 셋은 문제푸는데 집중 ㅋㅋㅋㅋ

즐거웠습니다 👍

# Event

프론트 크루 도리가 코수타를 진행했는데 너무 재미있었다 ㅋㅋㅋ

공원에게 대견하다는 실언(?)을 한 탓에 대견하다는 밈이 탄생한 것 같다. 🤣

# Learn

## ATDD

테스트가 가능한 요구사항으로 소프트웨어를 개발하는 프로세스다.

-> 인수 테스트로 소프트웨어를 개발하는 프로세스

### keyword

- 인수테스트란?
- 인수테스트 주도 개발은 무엇이고 왜 할까?
- TDD를 잘 하기 위해 인수테스트를 활용하는 방법?

### 서론

어떤 상황에서 ATDD를 사용할 수 있을까? (언제 효과가 있을까?)

프로젝트를 진행하거나 알고리즘, 디테일한 객체를 설계할 때 도메인 이해도가 부족해서 길을 잃는 상황이 종종 발생한다.

요구사항을 잘못 이해하는 경우도 존재한다.

명확한 요구사항을 정의하면 보다 효과적으로 개발할 수 있다.

### TDD vs ATDD

큰 범위에서는 TDD > ATDD 관계로 포함관계를 두고 있다고 볼 수 있다.

TDD 사이클 
(작은 단위의) 요구사항을 테스트로 구현 -> 동작하게 만든다 -> 리팩터링을한다

ATDD
(시나리오 형태의) 요구사항을 테스트로 구현 -> 동작하게 만든다 -> 리팩터링을한다

### ATDD 왜 사용해야할까?

- 생산성 증가
	- 구현 전에 인수테스트를 수행하는 경우 생산성이 두 배가 되는 경우가 있었다.
	- 실제로 요구사항을 잘 못 이해해서 작업 단계가 되돌아가는 과정에서 소요되는 리소스가 많이 든다.
	- 반복되는 리소스를 줄인다는 측면에서 생산성 향상을 이룰 수 있다고 생각할 수 있다.
- 작업의 명확한 시작과 끝을 제시한다.
- 빠른 피드백
	- 로컬에서 Application을 실행해보지 않아도 검증이 가능하다.
- 귀찮은 작업을 프로세스로 강제
	- TDD의 이점과 유사하다.
	- 테스트를 통해 문서화의 기능도 같이 할 수 있기 때문에 문서화 작업에 들이는 시간을 절약할 수 있다.

### Acceptance Test

Acceptance : 수락, 받아들임

소프트웨어 이외 다른 분야에서도 사용되는 용어다.

보통은 마지막 단계에서 수행하는 테스트를 의미한다.

인수테스트 : **사용자 스토리를 검증하는 기능 테스트**

-> 명세나 계약의 요구 사항이 충족되는지 확인하기 위한 테스트

쉽게 말해 해당 테스트가 통과하면 기능 구현은 끝! 이라는 뜻으로 이해해도 좋을 것 같다.

테스트의 종류

- 단위 테스트
- 통합 테스트
- E2E 테스트


#### 예시 : 로또 요구사항

다음과 같은 요구사항이 있다고 가정해 보자.

-   ﻿﻿콘솔 기반의 로또 애플리케이션을 만든다.
-   ﻿﻿금액을 입력하면 금액에 맞는 갯수의 로또를 구입한다.
-   ﻿﻿지난주 당첨 번호를 입력하면 당첨 결과와 수익률이 계산된다.

위 요구사항으로부터 나올 수 있는 정상적인 시나리오를 생각해보자.

1. 만원을 입력한다
2. 10장의 로또가 구매된다.
3. 구입한 10장의 로또 번호가 출력된다.
4. 지난 주 당첨 번호로 1,2,3,4,5,6 을 입력한다.
5. 당첨 통계가 출력된다.
6. 수익률이 출력된다.

다음과 같은 비정상 시나리오도 유추할 수 있다.

1. 100원을 입력한다.
2. 로또를 구매할 수 없다.


1. 1000원을 입력한다.
2. 10장의 로또가 구매된다.
3. 구입한 10장의 로또 번호가 출력된다.
4. 지난 주 당첨 번호로 1,1,1,1,1,1 을 입력한다.
5. 당첨 번호로는 중복되는 번호는 존재할 수 없다.


위와 같이 비정상 시나리오가 비교적 적은 step을 가지는 것을 확인할 수 있다.

따라서 비정상적인 시나리오를 먼저 가지고 TDD를 수행하면 보다 짧은 사이클로 ATDD를 수행할 수 있다.

API 레벨의 테스트 작성방식도 존재한다.

예를 들어 RestAssured를 이용해 실제 Application을 검증하듯이 API 요청을 하고 결과를 응답받는 식으로 시나리오 테스트를 작성할 수도 있다.

#### 그래서 ATDD는 뭘까?

그래서 인수테스트는 API, E2E, 통합테스트? 중 뭘까?

위 질문에 대한 정답은 테스트의 의도에 따라 구현 방법이 달라진다고 할 수 있다.

테스트가 검증하는 대상에 따라 달라진다고 볼 수 있다.


### 블랙박스 테스트

인수테스트는 블랙 박스 테스트의 성격을 가지고 있다.

예를 들어 API의 Request와 Response 정보 이외 내부 정보는 최대한 가린다.

다시말해 어떤 Request를 보냈을 때 어떤 Response가 오는지만 보면 된다.

### 도구

#### @SpringBootTest

- 테스트에 사용할 ApplicationContext를 쉽게 지정하게 도와준다.
- webEnvironment 설정
	- 실제 웹 환경을 구성하거나 (RANDOM_PORT, DEFINED_PORT)
	- 웹 환경을 구성하지 않는 방법 (NONE)이 존재한다.
	- WAS와 비슷한 역할을 하는 SpringBoot만의 환경을 만드는 즉, 환경을 Mocking하는 설정도 존재한다. (MOCK)
- 

#### RestAssured

- REST API의 테스트 검증을 단순화 할 수 있도록 설계되어있다.
- 외부 서비스에 대한 요청도 테스트할 수 있다.

#### MockMvc vs WebTestClient vs RestAssured

-   ﻿﻿MockMvc
	-   ﻿@SpringBootTest의 webEnvironment.MOCK과 함께 사용 가능하 며 mocking 된 web environment(ex tomcat) 환경에서 테스트
-   ﻿﻿WebTestClient
	-   ﻿﻿@SpringBootTest의 webEnvironment.RANDOM_PORT 나 DEFINED_PORT와 함께 사용, **Netty를 기본으로 사용**
-   ﻿﻿RestAssured
	-   ﻿﻿실제 web environment(Apache Tomcat)을 사용하여 테스트


### 인수테스트 격리?

@DirtiesContext와 같은 방식을 이용해 모든 테스트의 컨텍스트를 초기화 할 수 있다.

Bean의 상태가 같으면 재사용할 수가 없다.

Bean이 오염되었을 때 (변경사항이 존재할 때) Context를 다시 로드한다.

예를 들어 MockBean과 같이 특정 Bean에 대한 임의의 동작이 정의되었을 때 해당 Bean은 오염되었다고 정의할 수 있다.

이 경우 SpringBoot는 해당 Bean이 오염되었다고 간주하고 Context를 재사용하지 않는다.

DirtiesContext를 사용한다면 매번 Context를 새로 구성하다보니 시간이 많이 걸린다.

> DirtiesContext 이외의 테스트 격리방법에 대한 keyword를 찾아보자.

## 인수 테스트 주도 개발

ATDD + TDD Cycle

개발자들은 어떤 문제를 해결할 때 기술지향적으로 접근하려는 방식이 많다. 

서비스를 기획할 때는 어떤 문제를 해결할 지에 대한 부분에 초점을 맞춰야한다.

예를 들어 jenkins, redis, jpa 등등 기술을 적용한다는 부분은 사용자 문제해결에 아무런 도움도 되지 않는다.

- 검색을 하려고 Eleastic search를 사용한다 (x)
- 서비스 운영 중 검색 최적화가 필요하기 때문에  Eleastic search의 특정 기능을 사용했다 (o)

> 책 : 린 애자일 기법을 활용한 테스트 주도 개발
> 책 : 테스트 주도 개발로 배우는 객체 지향 설계와 실천


### 그래서 인수테스트 주도 개발 어떻게 하는데?

#### 인수 조건 정의

- 인수 테스트가 충족해야하는 조건
	- 시나리오 형태
	- 룰 형태(체크리스트)
	- 커스텀 포맷 등

```text
Feature: 최단 경로 구하기

scenario: 지하철 최단 경로 조회
	Given 지하철역들이 등록되어 있다.
	And 지하철노선이 등록되어 있다.
	And 지하철노선에 지하철역들이 등록되어 있다.
	When 사용자는 출발역과 도착역의 최단 경로 조회를 요청한다.
	Then 사용자는 최단 경로의 역 정보를 응답받는다.
```

#### 인수 테스트 작성

다양한 방법으로 인수테스트를 작성할 수 있다.

취향껏 작성한다.

- step별로 메서드를 분리하는 방법
- 한글로 작성하는 방법 등

#### 기능 구현

위 테스트를 기준으로 기능을 구현한다.

### 추천방법

- ﻿﻿Top-Down으로 방향을 잡고, Bottom-Up으로 구현하기
- ﻿﻿인수 테스트 작성을 통해 요구사항과 기능 전반에 대한 이해를 선행
- 내부 구현에 대한 설계 흐름을 구상
- 설계가 끝나면 도메인부터 차근차근 TDD로 기능 구현
- 만약 도메인이 복잡하거나 설계가 어려울 경우 이해하고 있는 부분 부터 기능 구현

중요한건 아는것을 기반으로 모르는 방향으로 진행하는 방식!


# Feel

매일같이 예비군 끝나고 일정을 소화하느라 무리했나...

몸살날거같다. 5시부터 몸이 슬슬 으슬으슬한게 주말에 뻗을 각일지도... 

잘 먹고 잘 자야겠다 💊